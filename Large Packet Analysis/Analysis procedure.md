보통 패킷 분석에 사용하는 도구는 Wireshark인데, 용량이 큰 파일을 Wireshark로 분석하려면 상당히 높은 사양의 메모리가 필요하고 성능에 따라 로딩에 많은 속도 차이가 발생한다.
그렇기 때문에 대용량 패킷을 분석하고자 할 때는 CLI 기반에서 진행한다.

---
**개요: DDoS 공격 '인바운드 트래픽'** <br/>
**목적지 IP: 192.168.0.80/24**
---

### 💡 capinfos를 활용한 패킷 기본 정보 분석
capinfos는 pcap 파일 자체의 정보를 출력한다. 와이어샤크의 summary 기능과 비슷하며 데이터가 언제 캡처되었는지, 평균 pps/bps 등의 기초 데이터로 활용하기 위해 주로 사용한다.

```$ capinfos <file name>```

![이미지-1](https://user-images.githubusercontent.com/66156026/210939911-c3b37a5e-1b33-426e-bb47-d59f3d603dae.jpg)


### 💡 tcpdstat를 활용한 패킷 덤프 트래픽 프로토콜 분석
capinfos와 마찬가지로 pcap 파일의 정보를 출력하고 패킷 사이즈별 통계, 프로토콜별 통계 정보를 얻을 수 있다.
```grep -v``` 명령어를 사용하여 비율이 거의 없는 데이터는 제외할 수 있다.

```$ tcpdstat <file name> | grep -v '( 0.00%)'```

- http(s): 서버 👉🏻 클라이언트로 전달되는 http 응답. src port 80
- http(c): 클라이언트 👉🏻 서버로 발생하는 http 요청. dst port 80

### 💡 공격 대상 IP 확인
공격 대상의 IP를 정확히 알고 필터링해야 정확한 공격 유형의 분석이 가능하므로 공격자 IP를 찾는 것은 아주 중요한 절차이다.

#### 🧸 tcpdump를 이용하여 공격 대상 파악
DDoS 공격 상황에서는 소수의 목적지 IP를 대상으로 과도한 패킷이 집중된다.
tcpdump에서는 저장된 pcap 파일을 읽을 때 ```-r```을 사용하고 ```-n```을 함께 사용하면 port 정보를 숫자값을 그대로 출력해주기 때문에 빠른 결과를 얻을 수 있다.

```$ tcpdump -nr <file name> not tcp```

![tcpdump](https://user-images.githubusercontent.com/66156026/210966353-b4717b1e-e932-4840-838c-31c616b341c5.png)

여러 목적지 IP가 공격 대상일지라도 pcap에서 해당 목적지 IP들이 대부분을 차지할 것이기 때문에 약 10,000줄 정도만 출력하여 목적지 IP를 정렬해보면 가장 많은 요청을 받은 IP를 가려낼 수 있을 것이다.

```$ tcpdump -nr <file name> not tcp | head -10000 | awk '{print $5}' | sort -n | uniq -c | sort -rn```

옵션|설명
:---:|:---:|
```-nr```|-r: 파일 읽기<br/> -n: port 정보를 문자열로 변환없이 숫자 그대로 출력(변환 절차가 없어 출력 속도가 빠름)
```not tcp```|not tcp: tcp를 제외한 프로토콜을 의미한다.
```head```|결과물의 첫 부분 몇 줄만 출력
```awk```|텍스트로 출력되는 결과물에서 특정 필드의 값만 출력할 때 사용하는 명령어이며 기본적으로는 공백을 기준으로 각 필드가 구분된다.<br/> '$5'의 의미는 공백을 기준으로 5번째의 값을 의미한다. 여기서는 5번째 값이 목적지 IP 부분이다.
```sort```|텍스트 결과물을 정렬할 때 사용하는 명령어로 ```-n```은 오름차순, ```-rn```은 내림차순 정렬이다.
```uniq```|텍스트 결과물에서 연속된 결괏값 중에 중복된 값이 있다면 한 번만 출력해준다.<br/> 주로 중복 제거를 위해 사용하며 ```-c```옵션을 이용하면 중복된 횟수를 출력해준다. <br/> 연속된 값에서 중복이 있으면 한 번만 출력해주는 역할이기에 sort로 정렬해준 후에 uniq를 사용해야 중복 제거가 된다.

<br/> 

#### 🧸 tshark를 활용한 IP별 통계
tshark를 이용해 세부적인 통계를 출력할 수 있다. 

```$ tshark -r <file name> -qz ip_hosts,tree```

**(사진)** 을 넣어야 하는데 파일 용량이 8GB가 넘어가다 보니 캡쳐가 안되네...

옵션|설명
:---:|:---:
```-r```|저장된 pcap 파일 읽기
```-q```|결과만 출력
```-z```|통계로 출력
```ip_hosts,tree```|```-z```(통계)의 옵션 값 중 한가지로 출발지/목적지 기반 통계 값을 출력하기 위한 옵션이다.

