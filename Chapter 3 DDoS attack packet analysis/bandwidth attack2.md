## 💡 반사 공격
반사 공격은 **인터넷에서 UDP 서비스를 사용하는 서버들을 매개체로 이용하여 DDoS를 발생시키는 공격 유형**이며, 좀비 PC가 아닌 실제 인터넷상에서 정상 운영 중인 UDP 서비스 서버들을 공격에 악용한다는 점에서 일반적인 DDoS 공격과 차이가 있다.

요청 패킷과 응답 패킷의 형상이 반사되는 형태를 띠기 때문에 반사 공격(Reflection Attack)이라고 하고, 응답 패킷이 요청 패킷보다 큰 특징 때문에 증폭 공격(Amplification Attack)이라고도 한다.

1. 공격자는 C&C를 이용하여 확보된 좀비 PC에게 공격 명령을 내린다.
2. 수많은 좀비 PC는 출발지 IP를 공격 대상의 IP로 위조하여 다수의 매개체 서버로 수많은 UDP 요청 패킷을 전송한다.
3. 요청 패킷을 수신한 매개체 서버는 특별한 검증 절차 없이 응답 패킷을 전송하며, 출발지 IP가 공격 대상의 IP로 위조되었기 때문에 모든 응답 패킷은 공격 대상에게 전송한다.

이 결과 대용량 응답 패킷 때문에 네트워크 대역폭이 고갈되어 정상 사용자도 접속하지 못하게 된다. 매개체에서 운영 중인 UDP 서비스의 종류에 따라 공격 명칭과 공격 방법은 달라지지만,
공격 형태는 출발지 포트만 다르고 거의 같다.

### 🧸 반사 공격의 피해자
반사 공격의 피해자는 실제 공격 대상 서버와 매개체 서버 두 군데로 구분할 수 있다.
<br/> 공격 대상 서버는 대용량의 응답 패킷 때문에 대역폭이 고갈되어 정상적인 서비스를 제공하지 못하는 피해가 발생하고, 매개체 서버는 비정상적인 요청에 의해 발생하는
상당한 양의 응답 패킷에 의해 아웃바운드 트래픽이 고갈될 수 있고 서버의 부하 증가로 장애가 발생하는 피해를 입을 수 있다.

### 🧸 반사 공격의 특징
✔️ **매개체 입장에서의 공격 패킷(요청 패킷)** <br/>
- 운영 중인 UDP 서비스로 많은 요청 패킷이 발생한다.
- 출발지 IP는 1~2개 정도로 아주 적다. (공격 대상의 IP로 위조된 IP)
- 목적지 포트는 매개체 서버에서 운영 중인 UDP 서비스의 포트 번호이다.

✔️ **공격 대상 입장에서의 공격 패킷(응답 패킷)** <br/>
- 대부분이 UDP 프로토콜이다.
- 응답 패킷이다.
- 출발지 포트는 특정 UDP 서비스에서 사용하는 포트 번호이다.
- ICMP destination unreachable 패킷이 수신될 수 있다.
- 출발지 포트 정보를 통해 어떤 UDP 서비스 서버가 매개체로 사용된 것인지 알 수 있고, 공격 유형 또한 여기서 정해진다. (출발지 포트 53 👉🏻 DNS 서버가 매개체 👉🏻 DNS 반사 공격)
- 출발지 IP는 실제 UDP 서비스에 사용되는 서버의 IP이다. (출발지 포트 53 👉🏻 DNS 서버가 매개체 👉🏻 공격 출발지 IP로 DNS 질의 테스트 👉🏻 정상 응답 확인 👉🏻 실제 DNS 서버로 인지)

만약 응답 값이 수신되지 않는다면 공격 툴이나 패킷 생성기를 이용하여 임의 생성한 패킷으로 간주할 수 있고, 과거에 캡쳐된 패킷에서 확인된 IP라면 해당 매개체 서버가 이미 보안 조치 되었을 가능성이 있다.

### 🧸 반사 공격의 대응 방안
✔️ **매개체 입장에서의 대응 방안** <br/>
&nbsp; 반사 공격에 사용되는 매개체 서버들은 주로 **권고되는 보안 설정이 되지 않은 상태로 인터넷상에 노출된 UDP 서비스 서버**들이다.
각 UDP 서비스별로 요구되는 **최소한의 보안 조치**를 해야 하고, 운영 중인 네트워크에 Anti-DDoS와 같은 차단 장비가 존재한다면 특정 출발지 IP로부터 요청되는 패킷을 임계치 기반으로 차단 설정할 수 있다.

✔️ **공격 대상 입장에서의 대응 방안** <br/>
&nbsp; 운영 중인 네트워크에서 UDP를 이용한 서비스가 운영되지 않는다고 해도 일반적으로 DNS(53), SNMP(161), NTP(123) 등의 UDP 프로토콜은 장비 운영 목적상 대부분 기본으로 상요하고 있다.
사용 중인 포트를 제외한 나머지 포트에 대한 UDP를 차단하거나, 신뢰할 수 있는 특정 호스트를 제외한 나머지 IP에 대해 UDP를 차단할 수 있다.
그러나 모든 시스템에서 기본적으로 사용 중인 DNS 통신을 위한 ```resolv.conf```와 같은 시스템에 설정된 DNS IP는 허용해야 한다. <br/>
&nbsp; 만약 운영 중인 네트워크에서 UDP를 사용한다면, 가장 먼저 UDP 서비스에 사용되는 목적지 IP를 제외한 나머지 IP에 대해 UDP를 차단할 수 있다.
UDP Flooding을 원천 차단하기 위한 것이며, 이외에도 UDP 서비스 서버의 IP에 대한 임계치 기반의 차단 설정이나 단편화된 패킷 차단, 특정 크기 이상의 패킷 차단 등의 세부적인 정책을 적용해야 한다.
